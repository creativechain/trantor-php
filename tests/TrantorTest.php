<?php

namespace Trantor\Tests;

require __DIR__ . '/../vendor/autoload.php';

use BitWasp\Bitcoin\Bitcoin;
use PHPUnit\Framework\TestCase;
use Trantor\Data\Author;
use Trantor\Data\BlockContent;
use Trantor\Data\Comment;
use Trantor\Data\ContentData;
use Trantor\Data\Follow;
use Trantor\Data\Like;
use Trantor\Data\MediaData;
use Trantor\Data\Payment;
use Trantor\Data\Unfollow;
use Trantor\Data\Unlike;
use Trantor\Network\CreativecoinTestnet;
use Trantor\Parser;

/**
 * Created by PhpStorm.
 * User: ander
 * Date: 16/03/18
 * Time: 18:17
 */
class TrantorTest extends TestCase
{
    protected function setUp()
    {
        parent::setUp();
        $net = new CreativecoinTestnet();
        Parser::setNetwork($net);
    }

    public function decode($hex, $class) {
        $data = Parser::getDataFromRawTx($hex);
        print_r($data);

        self::assertEquals($class, get_class($data));
    }

    public function testDecodeAuthor() {
        $hex = '01000000012c14468b32acd66bcc2d693c43fc29bb61a7a02c871797e72de92a914ecca687010000006b483045022100b802e0c159bd62a1997839941b887817be108e3b1efff5967d70b5ba93ce5d640220698c6e2e383696938091b975c53f27935cd20dd16f0c24a98b929f98b4d89456012102d28815f4d7a0d6eb083d8beb3dd0cd44a2aeb58e326f3cac54bf7440599dbc11ffffffff03a0860100000000001976a914bc1b2ba79a94d5f1d8e1ab77e6cd7d1ac9e158ce88ac92f9f535020000001976a914a6a01b5a68eecf5b13a1ac83833dfafbd9c978d688ac0000000000000000816a4c7eb800010002bc1b2ba79a94d5f1d8e1ab77e6cd7d1ac9e158ce064d616e6f6c6f00000946726f6e742d656e644e516d62615166695a41654a6e765753564631384445416f6a33386f6d72375a346e66506b436b475248334a5242382f6d616e6f6c6f2d6372656174697665636861696e2d70657266696c2e6a7067025b5d00000000';
        $this->decode($hex, Author::class);
    }

    public function testDecodeComment() {
        $hex = '0100000001ea8d24d3745200d4c663cc15afdf7f16fee1c65339e583d79213821aff0fa855010000006a47304402202adb19ad0602b794f14ae3fa54ed737fdf6f9b4a54ff8f52c537588a2c774f5d022027eabacb5a1658f9f07fbf5d78c8521955c80309cfafe723390fa07f00aa79c101210202f67378ef985b9138e47a00fa5f6a45534b27e2c492487f2ed72e02523e91a2ffffffff03a0860100000000001976a9140364a0a62d1e761858c9f101a1f5bb015f48f17888ac9fd9d653020000001976a91429d8b1627be55dc66f9809387280ce3b05cd80fb88ac0000000000000000366a34b8000100040364a0a62d1e761858c9f101a1f5bb015f48f178a569b4b2af3658ac1b04e81d1f446a447def3059066e657773212000000000';
        $this->decode($hex, Comment::class);
    }

    public function testDecodeFollow() {
        $hex = '0100000001b081fbdbe14b2bc6b8a6291619ddbd9ddb8acbdcecde4acd8058eb5e4618a42b010000006a473044022067ea0ebc73c53d39997b783c574855625c463e226dc99e840bfb60cea5d86cf7022042d1d43a3b3950154dae5046588732fef52fe9bc9b67da0dfc7c7ea24fe1887901210258fec65d6b8d62981f152a55f313620c1f07994e78dc5f26ec75d243dd5cf723ffffffff03a0860100000000001976a9140364a0a62d1e761858c9f101a1f5bb015f48f17888ac69d10054020000001976a91472aa4a562931e051b2bceeae3970c8e53ad9cc7888ac00000000000000002f6a2db8000100060364a0a62d1e761858c9f101a1f5bb015f48f17838b2c5641443a001fef7143337ed822d0887b20f00000000';
        $this->decode($hex, Follow::class);
    }

    public function testDecodeUnfollow() {
        $hex = '0100000001e31e9a9e2cbf0b3b2d6fde4d07750812c680896dff1979d4ac19f8073b093100010000006a473044022012aec222d093aeae2cd55eb900c0f3a828b0e256027d3d49a87c6e853556a67d02201e008cb04e6280ad461d1e059c622ee1e39df6e685c9fbc1e84c7e8fd36002d3012102702f91f3a39edd7b8613cc1105c6c0dac00d517762f594311a5f00c16c03b104ffffffff03a0860100000000001976a91438b2c5641443a001fef7143337ed822d0887b20f88ac501cf753020000001976a9144e2d57964a8efea7d243dbe22d6bbadb8833ab1888ac00000000000000002f6a2db80001000738b2c5641443a001fef7143337ed822d0887b20fbc1b2ba79a94d5f1d8e1ab77e6cd7d1ac9e158ce00000000';
        $this->decode($hex, Unfollow::class);
    }

    public function testDecodeBlock() {
        $hex = '0100000001ccfe84a79a694edf42c2eb817dac455c72028c16aa95337d518bb557b04c5d77010000006b483045022100ec0c816d6cd1e050d3f943d66bf654a40038d9c8d47e9a77be2df584248066f402200bbbed1d49a68d232c24c4729b29d6ff216258b3f63a05672db8b53a381a256a0121039d2fb3e4a8ff68d7e1f78f7672d842ff891287802ac047574cdc72a96a1ec9c6ffffffff03a0860100000000001976a9144ed37df225e8fb039488f29847178b4c511472b888aca4191e36020000001976a914a6943df1c4c4fd1691c34002f8e971998fa804ac88ac00000000000000002f6a2db8000100114ed37df225e8fb039488f29847178b4c511472b8720bd10ac6e9dc3618993da9b5345815f301949800000000';
        $this->decode($hex, BlockContent::class);
    }

    public function testDecodeLike() {
        $hex = '01000000019728dd49ecb1ce904bea0e933de4fd7fa20f68de66d92a26643cfd6c470c9816010000006a473044022064fe90407cc7c5715dd1bb80fbce08832fa2cc0a5e71d064a13f4bd83851095c02207aeb796083738d20c24a02f765a4a63d2c73db03e8c2a6b966ac7da70c184d800121033dc9b47ddd2224d47295205419cd47a5c88fc109746e1a4c684857406b3a290bffffffff03a0860100000000001976a914185f3c48ebb94c5300cce98df33955926e65937188acf663eb35020000001976a91473753c094cd6507905b91e2c077b098bdcaa02c188ac00000000000000002f6a2db800010003bc1b2ba79a94d5f1d8e1ab77e6cd7d1ac9e158ce185f3c48ebb94c5300cce98df33955926e65937100000000';
        $this->decode($hex, Like::class);
    }

    public function testDecodeMediaData() {
        $hex = '01000000019252696a973ae9890c65ded9a583d2194ca9899ee7dedad1978018facb7edbe3010000006a4730440220295bdfea6c8d9f443bcee51a05ff6119219c84cc159b4bda0063fcbcf36612dc02204c8521ab7ad3ae7408ac8f66c8acddc9945160b02b00f63123b5803c33cc2747012103357f9d9aa94f4eb65df5561010a01e76ebefd3bba05a7cb7b441a4cf68ef0d0fffffffff03a0860100000000001976a914216f25c13b737abe34d42c87ed50331589d35b1f88ac00d1f135020000001976a9142075ed30f3ae19df1dabb9839f1b9d1bf0ee669888ac0000000000000000c86a4cc5b8015d00000002b30000000000000000007ffe5092b26d79128092be3aafa35a67e6d9af2f93bd8a20ac5f53440e881bafcc917af6bade61c2dcf0c9dd10f3497196a57d8ea3fad58db2d7a481ba5586e825718c084d0dbcfa3136c43b38f4cbfe54a03e1522bc3909cf0b3d7cc126ce248a7b2dda6d9eb31b39aecbcb8facc1079089275c91bc2daf4fb07c918b3742377efe90f2f1f060c678005e236a249d80ef19ea789dfe14a1850f26363fa5dccb2ce799c12de6ad14b73046ed307bfffff2ec300000000000';
        $this->decode($hex, MediaData::class);
    }

    public function testDecodePayment() {
        $hex = '01000000014d7d8140a8955efe84afd5dd8f67c9112af7689d911a89e3ee48da19df69c556010000006a47304402200a7ce97cd2d9c4dd4200b0ae1eed8b834c067fb3cdf543bde54fe56f681f281502207b66d6dab18a20a3930a4bda79e7c74c76a61a09edec0e551dc75fc9bc03f05d01210322d05930885edf2dea052376ae1bfce0b9538b6030640ca47818cc85f7c27386ffffffff0380969800000000001976a914281b09b9d160eb9302774ac481da62091a8791b488ace0b76253020000001976a914b6f7dfaf9577550380eb331b7124658a6f59edd888ac0000000000000000376a35b8000100104cd2ab203fc188d83d50d0dec9534ed2c084ed89281b09b9d160eb9302774ac481da62091a8791b4000000000098968000000000';
        $this->decode($hex, Payment::class);
    }

}